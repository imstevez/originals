(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{108:function(e,t,a){e.exports=a(258)},258:function(e,t,a){"use strict";a.r(t);var i=a(23),r=a(24),n=a(26),s=a(25),l=a(27),o=a(0),c=a.n(o),d=a(16),m=a.n(d),h=a(106),p=a(35),u=a(102),g=a(21),v=a(22),f=a.n(v),w=a(32),E=a.n(w),b=a(33),k=a.n(b),y=a(29),S=a.n(y),j=a(17),O=a.n(j),N=a(28),x=a.n(N),C=a(66),L=a.n(C),V=a(68),P=a.n(V),T=a(46),z=a.n(T),B=a(67),A=a.n(B),I="E.g. example@example.com",R=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(n.a)(this,Object(s.a)(t).call(this,e))).state={disabled:!1,email:"",emailErr:!1,emailValid:!1,emailTips:I},a}return Object(l.a)(t,e),Object(r.a)(t,[{key:"handleEmail",value:function(e){var t=new RegExp("^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$");""===e.target.value||t.test(this.state.email)?""===e.target.value?this.setState({email:e.target.value,emailErr:!1,emailValid:!1}):this.setState({email:e.target.value,emailErr:!1,emailValid:!0}):this.setState({email:e.target.value,emailErr:!0,emailValid:!1})}},{key:"handleSubmit",value:function(){var e=this;this.state.emailValid?(fetch("http://www.koogo.net:8080/user/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.state.email})}).then(function(e){return 200!==e.status?{code:500,message:"internal error"}:e.json()}).then(function(t){200===t.code?(alert("Success, complete email has been send to your mailbox"),e.props.history.push("/login")):(e.setState({disabled:!1,emailErr:!0}),alert(t.message))}).catch(function(t){e.setState({disabled:!1}),alert(t)}),this.setState({disabled:!0})):this.setState({emailErr:!0})}},{key:"render",value:function(){var e=this,t=this.props.classes;return c.a.createElement("div",{className:t.container},c.a.createElement(E.a,null),c.a.createElement(f.a,{className:t.paper},c.a.createElement(O.a,{component:"h3",variant:"h6",color:"textPrimary",align:"right",gutterBottom:!0},"Register |  ",c.a.createElement("a",{href:"/login"},"Login")),c.a.createElement(x.a,{variant:"middle",className:t.divider}),c.a.createElement(S.a,{container:!0,justify:"center",className:t.grid,"aria-disabled":this.state.disabled},c.a.createElement(L.a,{className:t.formControl,error:this.state.emailErr},c.a.createElement(A.a,{htmlFor:"register-email"},"Email"),c.a.createElement(z.a,{id:"register-email",value:this.state.email,onChange:function(t){return e.handleEmail(t)},"aria-describedby":"register-email-error",disabled:this.state.disabled}),c.a.createElement(P.a,{id:"register-email-error"},this.state.emailTips)),c.a.createElement(k.a,{onClick:function(){return e.handleSubmit()},disabled:this.state.disabled,variant:"outlined",color:"primary",className:t.button,size:"large"},"REGISTER"))))}}]),t}(c.a.Component),D=Object(g.withStyles)(function(e){return{container:{marginTop:30},paper:{maxWidth:500,margin:"auto",padding:30},divider:{margin:0},grid:{display:"flex",margin:"20px 0",flexDirection:"column",justifyContent:"center",alignItems:"center"},formControl:Object(u.a)({width:"70%"},e.breakpoints.down("sm"),{width:"85%"}),button:{height:40,marginTop:20}}})(R),_=a(34),G=a.n(_),J=window.localStorage,M=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(n.a)(this,Object(s.a)(t).call(this,e))).state={disabled:!1,emailValidate:!1,passValidate:!1,email:"",password:"",emailErr:!1,passwordErr:!1},a}return Object(l.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){""!==J.token&&this.props.history.push("/profile")}},{key:"handleEmail",value:function(e){var t=new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$");this.setState({email:e.target.value}),""===this.state.email||t.test(this.state.email)?""===this.state.email?this.setState({emailErr:!1,emailValidate:!1}):this.setState({emailErr:!1,emailValidate:!0}):this.setState({emailErr:!0,emailValidate:!1})}},{key:"handlePass",value:function(e){this.setState({password:e.target.value}),""!==this.state.password?this.setState({passwordErr:!1,passValidate:!0}):this.setState({passwordErr:!1,passValidate:!1})}},{key:"handleLogin",value:function(){var e=this;this.state.emailValidate&&this.state.passValidate?(this.setState({disabled:!0}),fetch("http://www.koogo.net:8080/user/auth/login",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.state.email,password:this.state.password})}).then(function(e){return J.token=e.headers.get("x-login-token"),e.json()}).then(function(t){200===t.code?e.props.history.push("/profile"):(e.setState({disabled:!1,email:"",password:"",emailErr:!1,passwordErr:!1,emailValidate:!1,passwordValidate:!1}),alert(t.code+": "+t.message))}).catch(function(t){e.setState({disabled:!1}),alert(t)})):this.setState({emailErr:!this.state.emailValidate,passwordErr:!this.state.passValidate})}},{key:"render",value:function(){var e=this,t=this.props.classes;return c.a.createElement("div",{className:t.root},c.a.createElement(E.a,null),c.a.createElement(f.a,{className:t.paper},c.a.createElement(O.a,{component:"h1",variant:"h5",color:"textPrimary",gutterBottom:!0,align:"right"},"Login | ",c.a.createElement("a",{href:"/register"},"Register")),c.a.createElement(x.a,{variant:"middle",className:t.divider}),c.a.createElement(S.a,{container:!0,justify:"center"},c.a.createElement(G.a,{error:this.state.emailErr,id:"login-email",label:"Email",value:this.state.email,onChange:function(t){return e.handleEmail(t)},onBlur:function(t){return e.handleEmail(t)},type:"text",className:t.input,margin:"normal"}),c.a.createElement(G.a,{error:this.state.passwordErr,id:"login-pwd",label:"Password",value:this.state.password,onChange:function(t){return e.handlePass(t)},onBlur:function(t){return e.handlePass(t)},type:"password",className:t.input,margin:"normal"}),c.a.createElement(k.a,{variant:"contained",color:"primary",disabled:this.state.disabled,className:t.button,size:"large",onClick:function(t){return e.handleLogin()}},"LOGIN"))))}}]),t}(c.a.Component),F=Object(g.withStyles)(function(e){return{root:{width:"auto",display:"block",padding:"50px 0"},paper:{width:600,margin:"auto",padding:"40px 30px"},input:{width:400},button:{margin:20,width:150},rightIcon:{marginLeft:e.spacing.unit},divider:{margin:"0 0 10px 0"},bigAvatar:{margin:10,width:100,height:100,cursor:"pointer"},fileInput:{display:"none"}}})(M),U=a(104),Z=a.n(U),$=a(105),q=a.n($),W=a(52),H=a.n(W),K=window.localStorage,Q=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(n.a)(this,Object(s.a)(t).call(this,e))).state={avatar:"",id:"",email:"",nickname:""},a}return Object(l.a)(t,e),Object(r.a)(t,[{key:"redirectLogin",value:function(){K.token="",this.props.history.push("/login")}},{key:"handleLogout",value:function(){var e=this;fetch("http://www.koogo.net:8080/user/auth/logout",{method:"POST",mode:"cors",headers:{"x-login-token":K.token}}).then(function(e){return e.json()}).then(function(t){alert(t.message),localStorage.token="",e.props.history.push("/login")}).catch(function(t){localStorage.token="",alert(t),e.props.history.push("/login")})}},{key:"componentDidMount",value:function(){var e=this;""===K.token?this.props.history.push("/login"):fetch("http://www.koogo.net:8080/user/info/",{headers:{"x-login-token":K.token},mode:"cors"}).then(function(e){return e.json()}).then(function(t){200===t.code?e.setState({email:t.data.email,id:t.data.user_id,nickname:t.data.nickname,avatar:t.data.avatar}):(alert(t.message),e.redirectLogin())}).catch(function(t){alert(t),e.redirectLogin()})}},{key:"render",value:function(){var e=this,t=this.props.classes;return c.a.createElement("div",{className:t.root},c.a.createElement(E.a,null),c.a.createElement(Z.a,{position:"static",className:t.appBar},c.a.createElement(q.a,null,c.a.createElement(O.a,{variant:"h6",color:"inherit",className:t.grow},"Profile"),c.a.createElement(k.a,{color:"inherit",onClick:function(){e.handleLogout()}},"LOGOUT"))),c.a.createElement(f.a,{className:t.paper,elevation:1},c.a.createElement(S.a,{container:!0,justify:"center"},c.a.createElement(H.a,{src:this.state.avatar,className:t.bigAvatar})),c.a.createElement(x.a,{variant:"middle",className:t.divider}),c.a.createElement(S.a,{container:!0,justify:"center",direction:"column"},c.a.createElement(O.a,{gutterBottom:!0,variant:"h6",component:"h3"},this.state.id),c.a.createElement(x.a,{variant:"middle",className:t.divider}),c.a.createElement(O.a,{gutterBottom:!0,variant:"h6",component:"h3"},this.state.nickname),c.a.createElement(x.a,{variant:"middle",className:t.divider}),c.a.createElement(O.a,{gutterBottom:!0,variant:"h6",component:"h3"},this.state.email))))}}]),t}(c.a.Component),X=Object(g.withStyles)(function(e){return{root:{flexGrow:1},grow:{flexGrow:1},appBar:{height:60},menuButton:{marginLeft:-12,marginRight:20},paper:{width:600,margin:"auto",padding:30,marginTop:20},input:{width:400},button:{margin:20,height:50,width:200},rightIcon:{marginLeft:e.spacing.unit},divider:{margin:"0 0 20px 0"},bigAvatar:{margin:10,width:100,height:100,cursor:"pointer"},fileInput:{display:"none"},b:{display:"flex",width:300}}})(Q),Y=function(e){function t(e){var a;Object(i.a)(this,t);return(a=Object(n.a)(this,Object(s.a)(t).call(this,e))).state={disabled:!1,err:{nickname:!1,password:!1},validate:{nickname:!1,password:!1},data:{token:"",email:"",nickname:"",password:"",avatar:"",avatarSrc:"http://www.koogo.net:8080/user/statics/avatar/avatar_default.png"}},a}return Object(l.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.match.params.token.split(".")[1],t=JSON.parse(atob(e)),a=(new Date).getTime();if(!t.email)return alert("token invalid"),void this.props.history.push("/register");if(a>1e3*t.exp)return alert("token expired, please register again"),void this.props.history.push("/register");var i=this.state.data;i.token=this.props.match.params.token,i.email=t.email,this.setState({data:i})}},{key:"handleName",value:function(e){var t=this.state.data;if(t.nickname=e.target.value,this.setState({data:t}),""===this.state.data.nickname){var a=this.state.err,i=this.state.validate;a.nickname=!1,i.nickname=!1,this.setState({err:a,validate:i})}else if(this.state.data.nickname.length<4){var r=this.state.err,n=this.state.validate;r.nickname=!0,n.nickname=!1,this.setState({err:r,validate:n})}else{var s=this.state.err,l=this.state.validate;s.nickname=!1,l.nickname=!0,this.setState({err:s,validate:l})}}},{key:"handlePassword",value:function(e){var t=this.state.data;if(t.password=e.target.value,this.setState({data:t}),""===this.state.data.password){var a=this.state.err,i=this.state.validate;a.password=!1,i.password=!1,this.setState({err:a,validate:i})}else if(this.state.data.password.length<4){var r=this.state.err,n=this.state.validate;r.password=!0,n.password=!1,this.setState({err:r,validate:n})}else{var s=this.state.err,l=this.state.validate;s.password=!1,l.password=!0,this.setState({err:s,validate:l})}}},{key:"handleSubmit",value:function(){var e=this;if(this.state.validate.nickname&&this.state.validate.password){this.setState({disabled:!0});var t=new FormData;t.append("nickname",this.state.data.nickname),t.append("password",this.state.data.password),this.state.data.avatar&&t.append("avatar",this.state.data.avatar),fetch("http://www.koogo.net:8080/user/auth/complete",{method:"POST",headers:{"x-register-token":this.state.data.token},body:t}).then(function(e){return e.json()}).then(function(t){if(200===t.code)alert("register complete successfully, please login"),e.props.history.push("/login");else{alert(t.code+": "+t.message),301===t.code&&e.props.history.push("/login");var a=e.state.err;a.nickname=!0,a.password=!0,e.setState({disabled:!1,err:a})}}).catch(function(t){e.setState({disabled:!1}),alert(t)})}}},{key:"handleAvatar",value:function(e){var t=URL.createObjectURL(e.target.files[0]),a=this.state.data;a.avatarSrc=t,a.avatar=e.target.files[0],this.setState({data:a})}},{key:"render",value:function(){var e=this,t=this.props.classes,a=this.state.data,i=this.state.err;return c.a.createElement("div",{className:t.root},c.a.createElement(E.a,null),c.a.createElement(f.a,{className:t.paper,elevation:1},c.a.createElement(O.a,{component:"h1",variant:"h5",color:"textPrimary",gutterBottom:!0},"Complete"),c.a.createElement(x.a,{variant:"middle",className:t.divider}),c.a.createElement(S.a,{container:!0,justify:"center"},c.a.createElement("input",{accept:"image/*",className:t.fileInput,id:"avatar-file",multiple:!0,type:"file",onChange:function(t){return e.handleAvatar(t)}}),c.a.createElement("label",{htmlFor:"avatar-file"},c.a.createElement(H.a,{alt:"",src:a.avatarSrc,className:t.bigAvatar}))),c.a.createElement(S.a,{container:!0,justify:"center"},c.a.createElement(G.a,{id:"complete-email",disabled:!0,label:"Email",type:"text",value:a.email,className:t.input,margin:"normal"}),c.a.createElement(G.a,{id:"complete-nickname",error:i.nickname,value:a.nickname,onChange:function(t){return e.handleName(t)},label:"Nickname",type:"text",className:t.input,margin:"normal"}),c.a.createElement(G.a,{id:"complete-password",error:i.password,value:a.password,onChange:function(t){return e.handlePassword(t)},label:"Password",type:"password",className:t.input,margin:"normal"}),c.a.createElement(k.a,{variant:"contained",disabled:this.state.disabled,onClick:function(){return e.handleSubmit()},color:"primary",className:t.button,size:"large"},"COMPLETE"))))}}]),t}(c.a.Component),ee=Object(g.withStyles)(function(e){return{root:{width:"auto",display:"block",padding:"50px 0"},paper:{width:600,margin:"auto",padding:"40px 30px"},input:{width:400},button:{margin:20,width:150},rightIcon:{marginLeft:e.spacing.unit},divider:{margin:"0 0 20px 0"},bigAvatar:{margin:10,width:100,height:100,cursor:"pointer"},fileInput:{display:"none"}}})(Y),te=function(e){function t(){return Object(i.a)(this,t),Object(n.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return c.a.createElement(h.a,null,c.a.createElement(p.a,{path:"/",exact:!0,component:X}),c.a.createElement(p.a,{path:"/Register",component:D}),c.a.createElement(p.a,{path:"/Complete/:token",component:ee}),c.a.createElement(p.a,{path:"/login",component:F}),c.a.createElement(p.a,{path:"/profile",component:X}))}}]),t}(c.a.Component);m.a.render(c.a.createElement(te,null),document.querySelector("#root"))}},[[108,1,2]]]);
//# sourceMappingURL=main.f3ca1e7e.chunk.js.map